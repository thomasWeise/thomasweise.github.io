{%- assign pubshort = include.short | default: false -%}
{%- assign publong = false -%}
{%- unless pubshort -%}
    {%- assign publong = true -%}
{%- endunless -%}
{%- capture pubtext -%}
{%- assign thepaper = include.paper -%}
{%- unless thepaper.key -%}
    {%- assign thepapers = site.data.publications | where: "key", include.paper -%}
    {%- assign thepaper = thepapers[0]  -%}
{%- endunless -%}
{%- assign key_is_id = false -%}
{%- if page.url == "/research/publications" -%}
    {%- assign key_is_id = true -%}
{%- endif -%}
<li{%- if publong and thepaper.type %} class="pub{{ thepaper.type -}}"{%- endif -%}{%- if key_is_id %} id="{{- thepaper.key -}}"{%- endif -%}>
{%- include persons.liquid persons=thepaper.authors -%}
{%- if thepaper.authors_are_editors -%}, editors, {% else -%}:&nbsp;{%- endif -%}
{{- thepaper.title -}}.
{% if publong -%}
    {%- if thepaper.editors %} In&nbsp;{%- include persons.liquid persons=thepaper.editors -%}, editors, {% endif %}
{%- endif %}
{{ thepaper.citation -}}.
{%- if publong -%}
    {%- assign block = "" -%}
    {%- assign block_empty = true -%}
    {%- if thepaper.isbn -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: 'ISBN:&nbsp;<a href="https://isbnsearch.org/isbn/' | append: thepaper.isbn | append: '">' | append: thepaper.isbn | append: "</a>" -%}
    {%- endif -%}
    {%- if thepaper.issn -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: 'ISSN:&nbsp;<a href="https://portal.issn.org/api/search?search[]=MUST=allissnbis=' | append: thepaper.issn | append: '">' | append: thepaper.issn | append: '</a>' -%}
    {%- endif -%}
    {%- if thepaper.doi -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: 'doi:<a href="https://doi.org/' | append: thepaper.doi | append: '">' | append: thepaper.doi | append: '</a>' -%}
    {%- endif -%}
    {%- unless block_empty -%}
        {%- assign block = block | remove: '<p>' | remove: '</p>' | strip | normalize_whitespace -%}
        <div class="pubrefs">{{- block -}}.</div>
    {%- endunless -%}
    {%- assign block = "" -%}
    {%- assign block_empty = true -%}
    {%- if thepaper.ccf -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">中国计算机学会' | append: thepaper.ccf | append: '类</span>' -%}
    {%- endif -%}
    {%- if thepaper.cas -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">中国科学院分' | append: thepaper.cas | append: '区</span>' -%}
    {%- endif -%}
    {%- if thepaper.caa -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">中国自动化学会' | append: thepaper.caa | append: '类</span>' -%}
    {%- endif -%}
    {%- if thepaper.caai -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">中国人工智能学会' | append: thepaper.caai | append: '类</span>' -%}
    {%- endif -%}
    {%- if thepaper.thcpl -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">清华大学计算机学科' | append: thepaper.thcpl | append: '群</span>' -%}
    {%- endif -%}
    {%- if thepaper.fms -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">FMS-' | append: thepaper.fms | append: '类</span>' -%}
    {%- endif -%}
    {%- if thepaper.cms -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '<span lang="zh-Hans">CMS-' | append: thepaper.cms | append: '类</span>' -%}
    {%- endif -%}
    {%- if thepaper.if -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: 'IF=' | append: thepaper.if -%}
    {%- endif -%}
    {%- if thepaper.index -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
            {%- assign block = "Indexed in&nbsp;" -%}
        {%- else -%}
            {%- assign block = block | append: ", indexed in&nbsp;" -%}
        {%- endif -%}
        {%- capture bi -%}
            {%- include print_array.liquid array=thepaper.index -%}
        {%- endcapture -%}
        {%- assign block = block | append: bi -%}
    {%- endif -%}
    {%- unless block_empty -%}
        {%- assign block = block | remove: '<p>' | remove: '</p>' | strip | normalize_whitespace -%}
        <div class="pubindex">{{- block -}}.</div>
    {%- endunless -%}
    {%- assign block = "" -%}
    {%- assign block_empty = true -%}
    {%- if thepaper.rg -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '[<a href="https://www.researchgate.net/publication/' | append: thepaper.rg | append: '">R<sup>G</sup></a>]' -%}
    {%- endif -%}
    {%- if thepaper.arxiv -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '[<a href="https://arxiv.org/abs/' | append: thepaper.arxiv | append: '">arXiv</a>]' -%}
    {%- endif -%}
    {%- if thepaper.url -%}
        {%- for theurl in thepaper.url -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: '[<a href="' | append: theurl | append: '">link</a>]' -%}
        {%- endfor -%}
    {%- endif -%}
    {%- if thepaper.slides -%}
        {%- for theslides in thepaper.slides -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: '[<a href="' | append: theslides | append: '">slides</a>]' -%}
        {%- endfor -%}
    {%- endif -%}
    {%- if thepaper.code -%}
        {%- for thecode in thepaper.code -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: '[<a href="' | append: thecode | append: '">code</a>]' -%}
        {%- endfor -%}
    {%- endif -%}
    {%- if thepaper.data -%}
        {%- for thedata in thepaper.data -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: '[<a href="' | append: thedata | append: '">data</a>]' -%}
        {%- endfor -%}
    {%- endif -%}
    {%- if thepaper.supplement -%}
        {%- for thesupplement in thepaper.supplement -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: '[<a href="' | append: thesupplement | append: '">supplement</a>]' -%}
        {%- endfor -%}
    {%- endif -%}
    {%- if thepaper.dblp -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '[<a href="' | append: thepaper.dblp | append: '">dblp</a>], [<a href="' | append: thepaper.dblp | append: '?view=bibtex">bibTeX</a>]' -%}
    {%- endif -%}
    {%- if thepaper.gpbib -%}
        {%- if block_empty -%}
            {%- assign block_empty = false -%}
        {%- else -%}
            {%- assign block = block | append: ", " -%}
        {%- endif -%}
        {%- assign block = block | append: '[<a href="https://gpbib.cs.ucl.ac.uk/gp-html/' | append: thepaper.gpbib | append: '.html">GPbib</a>]' -%}
    {%- endif -%}
    {%- unless block_empty -%}
        {%- assign block = block | remove: '<p>' | remove: '</p>' | strip | normalize_whitespace -%}
        <div class="publinks">{{- block -}}.</div>
    {%- endunless -%}
{%- endif -%}
{%- assign block = "" -%}
{%- assign block_empty = true -%}
{%- if thepaper.tags -%}
    {%- for the_tag in thepaper.tags -%}
        {%- capture the_tag_text -%}
            {%- include taglink.liquid tag=the_tag class="pubtag" only_link=true -%}
        {%- endcapture -%}
        {%- if the_tag_text and the_tag_text != '' -%}
            {%- if block_empty -%}
                {%- assign block_empty = false -%}
            {%- else -%}
                {%- assign block = block | append: ", " -%}
            {%- endif -%}
            {%- assign block = block | append: the_tag_text | strip -%}
        {%- endif -%}
    {%- endfor -%}
{%- endif -%}
{%- if block_empty %}{%- unless publong %} <a class="pubinfos" href="/research/publications#{{- thepaper.key -}}">infos</a>{%- endunless -%}
{%- else -%}
    {%- unless publong -%}
        {%- assign block = block | append: ', <a class="pubinfos" href="/research/publications#' | append: thepaper.key | append: '">more&nbsp;infos</a>' -%}
    {%- endunless -%}
    {%- assign block = block | remove: '<p>' | remove: '</p>' | strip | normalize_whitespace -%}
    <div class="pubtags">{{- block -}}.</div>
{%- endif -%}
</li>
{%- endcapture -%}
{{- pubtext | remove: '<p>' | remove: '</p>' | strip | normalize_whitespace | strip | normalize_whitespace | replace: " ,", "," | replace: " .", "." | replace: "..", "." | replace: "?.", "?" | replace: "!.", "!" | append: "öäü@" | remove: ".öäü@" | remove: "öäü@" | strip | replace: "?.", "?" | replace: "!.", "!" | replace: ".,", "," -}}
